$(function(){function l(){var n=$(this);r.val()=="468"?($("#SendType_0").prop({checked:!0,disabled:!1}),$("#SendType_1, #SendType_2").prop({checked:!1,disabled:!0}),$("#PaymentType_2").prop({disabled:!1})):($("#SendType_0").prop({checked:!1,disabled:!0}),$("#SendType_1").prop({disabled:!1,checked:!0}),$("#SendType_2").prop({disabled:!1}),$("#PaymentType_2").prop({checked:!1,disabled:!0}),$("#PaymentType_0, #PaymentType_1").is(":checked")||$("#PaymentType_0").prop({checked:!0}))}var t=$(".btn-nextstep"),i=$(".btn-prevstep"),n=1,f=$(".steps-box"),o=$(".user-info"),a=$(".methods"),v=$(".cart-box"),s=$("#Payment"),it=$(".btn-pay"),e=$("#BankMellat"),y=$(".sendtype"),h=$(".paymenttype"),p=$("#Firstname"),w=$("#Lastname"),b=$("#Email"),k=$("#Phone"),d=$("#Mobile"),c=$(".delivery-info"),g=$("#PostalCode"),nt=$("#HomeAddress"),tt=$("#UserDescription"),u=$("#States"),r=$("#Cities");t.on("click",function(l){var et,ft,rt,it,ut;if(l.preventDefault(),et=$(this),n==2||n==3){if(!s.valid())return;n==2&&(ft=parseInt($(".step-content-1 .total-topay").data("price")),isFreeDelivery(ft)?c.text(staticTexts.MaxPriceFreeDelivery):c.text("هزینه ثابت 10 هزار تومان"));copyCart()}else if(n==4){rt=$(staticTemplates.Loading);v.append(rt);it={SendMethodType:y.find(":checked").val(),PaymentMethodType:h.find(":checked").val(),UserDescription:tt.val()};isAuthenticated||(it.Firstname=p.val(),it.Lastname=w.val(),it.Email=b.val(),it.Phone=k.val(),it.Mobile=d.val(),it.StateID=u.val(),it.CityID=r.val(),it.PostalCode=g.val(),it.HomeAddress=nt.val());$.ajax({type:"POST",url:"/Cart/Payment",data:it,success:function(r){if(r.Success){var u=r.Data;it.PaymentMethodType==0?(e.attr("action",u.PgwSite),e.find("#RefID").val(u.RefID),e.submit(),toastr.success("در حال ارسال به بانک","پرداخت سبد خرید")):(it.PaymentMethodType==1||it.PaymentMethodType==2)&&(toastr.success("اطلاعات شما با موفقیت ثبت شد.","ثبت سفارش"),n++,$(".step-content").hide(),$(".step-content-"+n).show(),f.find(".btn-step").removeClass("active").eq(n-1).addClass("active").prevAll().addClass("success"),t.hide(),i.hide(),it.PaymentMethodType==1?($(".step-content-5 .price").html(toPrice(u.ToPayPrice,'{0} <span class="price-unit">{1}<\/span>')),$(".step-content-5 .type_1").show(),$(".step-content-5 .type_2").hide()):it.PaymentMethodType==2&&($(".step-content-5 .type_2").show(),$(".step-content-5 .type_1").hide()))}else toastr.error(staticTexts.ResponseError,"پرداخت سبد خرید")},error:function(){toastr.error(staticTexts.RequestError,"پرداخت سبد خرید")},complete:function(){rt.remove()}});return}if(n++,$(".step-content").hide(),$(".step-content-"+n).show(),f.find(".btn-step").removeClass("active").eq(n-1).addClass("active").prevAll().addClass("success"),n==2)t.find("span").text("دریافت اطلاعات پستی"),i.find("span").text("مشاهده سبد خرید"),t.show(),i.show();else if(n==3)t.find("span").text("پرداخت سبد خرید"),i.find("span").text("دریافت اطلاعات شخصی"),t.show(),i.show();else if(n==4)ut="",ut=h.find(":checked").val()=="0"?"ارسال به بانک":"ثبت سفارش",t.find("span").text(ut),i.find("span").text("دریافت اطلاعات پستی"),t.show(),i.show();else{if(isAuthenticated){if(o.find("i").hasClass("fa-times-circle")){toastr.error("لطفا اطلاعات خود را تکمیل نمایید");return}}else{if(!s.valid())return;if(u.val()==-1||r.val()==-1){toastr.error("تکمیل فیلد استان و شهر الزامی است");return}}o.hide();a.show()}});i.on("click",function(r){r.preventDefault();n--;$(".step-content").hide();$(".step-content-"+n).show();f.find(".btn-step").removeClass("active success").eq(n-1).addClass("active").prevAll().addClass("success");n==1&&(t.find("span").text("دریافت اطلاعات شخصی"),i.find("span").text("مشاهده سبد خرید"),t.show(),i.hide());n==2?(t.find("span").text("دریافت اطلاعات پستی"),i.find("span").text("مشاهده سبد خرید"),t.show(),i.show()):n==3&&(t.find("span").text("پرداخت سبد خرید"),i.find("span").text("دریافت اطلاعات شخصی"),t.show(),i.show())});u.val("");r.val("");u.on("change",l);r.on("change",l).change()});